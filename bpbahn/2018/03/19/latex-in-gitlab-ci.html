<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Automating in Gitlab-CI | HPI Bachelorprojekte 2017</title>
<meta name="generator" content="Jekyll v3.6.2" />
<meta property="og:title" content="Automating in Gitlab-CI" />
<meta name="author" content="Marcus Ding" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The problem You are pushing LateX documents into a repository with all of your friends. Your friends compile the PDF files locally and sometimes push garbage into the repo. This makes you very sad. You ask yourself: What could I do about it? The solution def compile_pdfs(self): &quot;&quot;&quot;compile every TeX file in each repository subfolder&quot;&quot;&quot; second_level_items = {} self.first_level_dirs = self.remove_exempt_folders(self.first_level_dirs) for first_level_dir in self.first_level_dirs: dir_path = join(self.relative_path, first_level_dir) files_folders = get_files_folders(dir_path) second_level_items[first_level_dir] = files_folders for dir_name, data in second_level_items.items(): self.enforce_compliance(dir_name, data) for dir_name, data in second_level_items.items(): main_filename = dir_name + &quot;.tex&quot; folderpath = join(self.relative_path, dir_name) cmd = (&#39;cd &quot;{fp}&quot; &amp;&amp; latexmk -output-directory=../latex_output -pdf &quot;{f}&quot;&#39;\ &quot; -e &#39;$pdflatex=q/pdflatex %O -shell-escape %S/&#39;&quot;)\ .format(fp=folderpath, f=main_filename) if call(cmd, shell=True) == 0: sccmsg = &quot;\033[92mCompiled \033[94m{d}.tex\033[92m successfully\033[0m&quot;\ .format(d=dir_name) print(sccmsg) else: errmsg = &quot;\033[91mError with compiling \033[94m{d}.tex\033[0m\ncmd: {c}&quot;\ .format(d=dir_name, c=cmd) self.error_notify_and_exit(errmsg)" />
<meta property="og:description" content="The problem You are pushing LateX documents into a repository with all of your friends. Your friends compile the PDF files locally and sometimes push garbage into the repo. This makes you very sad. You ask yourself: What could I do about it? The solution def compile_pdfs(self): &quot;&quot;&quot;compile every TeX file in each repository subfolder&quot;&quot;&quot; second_level_items = {} self.first_level_dirs = self.remove_exempt_folders(self.first_level_dirs) for first_level_dir in self.first_level_dirs: dir_path = join(self.relative_path, first_level_dir) files_folders = get_files_folders(dir_path) second_level_items[first_level_dir] = files_folders for dir_name, data in second_level_items.items(): self.enforce_compliance(dir_name, data) for dir_name, data in second_level_items.items(): main_filename = dir_name + &quot;.tex&quot; folderpath = join(self.relative_path, dir_name) cmd = (&#39;cd &quot;{fp}&quot; &amp;&amp; latexmk -output-directory=../latex_output -pdf &quot;{f}&quot;&#39;\ &quot; -e &#39;$pdflatex=q/pdflatex %O -shell-escape %S/&#39;&quot;)\ .format(fp=folderpath, f=main_filename) if call(cmd, shell=True) == 0: sccmsg = &quot;\033[92mCompiled \033[94m{d}.tex\033[92m successfully\033[0m&quot;\ .format(d=dir_name) print(sccmsg) else: errmsg = &quot;\033[91mError with compiling \033[94m{d}.tex\033[0m\ncmd: {c}&quot;\ .format(d=dir_name, c=cmd) self.error_notify_and_exit(errmsg)" />
<link rel="canonical" href="/bpbahn/2018/03/19/latex-in-gitlab-ci.html" />
<meta property="og:url" content="/bpbahn/2018/03/19/latex-in-gitlab-ci.html" />
<meta property="og:site_name" content="HPI Bachelorprojekte 2017" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-19T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"The problem You are pushing LateX documents into a repository with all of your friends. Your friends compile the PDF files locally and sometimes push garbage into the repo. This makes you very sad. You ask yourself: What could I do about it? The solution def compile_pdfs(self): &quot;&quot;&quot;compile every TeX file in each repository subfolder&quot;&quot;&quot; second_level_items = {} self.first_level_dirs = self.remove_exempt_folders(self.first_level_dirs) for first_level_dir in self.first_level_dirs: dir_path = join(self.relative_path, first_level_dir) files_folders = get_files_folders(dir_path) second_level_items[first_level_dir] = files_folders for dir_name, data in second_level_items.items(): self.enforce_compliance(dir_name, data) for dir_name, data in second_level_items.items(): main_filename = dir_name + &quot;.tex&quot; folderpath = join(self.relative_path, dir_name) cmd = (&#39;cd &quot;{fp}&quot; &amp;&amp; latexmk -output-directory=../latex_output -pdf &quot;{f}&quot;&#39;\\ &quot; -e &#39;$pdflatex=q/pdflatex %O -shell-escape %S/&#39;&quot;)\\ .format(fp=folderpath, f=main_filename) if call(cmd, shell=True) == 0: sccmsg = &quot;\\033[92mCompiled \\033[94m{d}.tex\\033[92m successfully\\033[0m&quot;\\ .format(d=dir_name) print(sccmsg) else: errmsg = &quot;\\033[91mError with compiling \\033[94m{d}.tex\\033[0m\\ncmd: {c}&quot;\\ .format(d=dir_name, c=cmd) self.error_notify_and_exit(errmsg)","author":{"@type":"Person","name":"Marcus Ding"},"@type":"BlogPosting","url":"/bpbahn/2018/03/19/latex-in-gitlab-ci.html","headline":"Automating in Gitlab-CI","dateModified":"2018-03-19T00:00:00+00:00","datePublished":"2018-03-19T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/bpbahn/2018/03/19/latex-in-gitlab-ci.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="HPI Bachelorprojekte 2017" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a href="/" class="site-title"><span id="first-name">HPI</span><span id="last-name"> BP17</span></a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
                <a class="page-link" href="/about/">about</a>
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/overview/">overview</a>
              
            
          
            
            
              
            
          
            
            
              
                <a class="page-link" href="/tags/">tags</a>
              
            
          
            
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
          
            
            
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              <a class="page-link" href="/category/bpgetimed/index.html">bpgetimed</a>
            
          
            
              <a class="page-link" href="/category/bpbigdatasecurity/index.html">bpbigdatasecurity</a>
            
          
            
              <a class="page-link" href="/category/bpbahn/index.html">bpbahn</a>
            
          
            
          
            
          
          <a class="page-link" href="/search/">
            <i class="fa fa-search"></i>
          </a>
        </div>
      </nav>
    
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Automating in Gitlab-CI</h1>
    <p class="post-meta">
      <time datetime="2018-03-19T00:00:00+00:00" itemprop="datePublished">
        
        Mar 19, 2018
      </time>
      
        â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="/search/?query=Marcus+Ding">Marcus Ding</a>
</span></span>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="the-problem">The problem</h2>

<p>You are pushing LateX documents into a repository with all of your friends. Your friends compile the PDF files locally and sometimes push garbage into the repo. This makes you very sad. You ask yourself: What could I do about it?</p>

<p><img src="https://hpi.de/fileadmin/user_upload/hpi/bilder/teaser_channels/studenten/students_2_boys_girl_main_entrance_1020x420.jpg" alt="Cooles Symbolbild" title="Cooles Symbolbild" /></p>

<h2 id="the-solution">The solution</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">compile_pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">"""compile every TeX file in each repository subfolder"""</span>
    <span class="n">second_level_items</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_level_dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_exempt_folders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_level_dirs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">first_level_dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_level_dirs</span><span class="p">:</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relative_path</span><span class="p">,</span> <span class="n">first_level_dir</span><span class="p">)</span>
        <span class="n">files_folders</span> <span class="o">=</span> <span class="n">get_files_folders</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="n">second_level_items</span><span class="p">[</span><span class="n">first_level_dir</span><span class="p">]</span> <span class="o">=</span> <span class="n">files_folders</span>

    <span class="k">for</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">second_level_items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_compliance</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">second_level_items</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">main_filename</span> <span class="o">=</span> <span class="n">dir_name</span> <span class="o">+</span> <span class="s">".tex"</span>
        <span class="n">folderpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relative_path</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s">'cd "{fp}" &amp;&amp; latexmk -output-directory=../latex_output -pdf "{f}"'</span>\
            <span class="s">" -e '$pdflatex=q/pdflatex </span><span class="si">%</span><span class="s">O -shell-escape </span><span class="si">%</span><span class="s">S/'"</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fp</span><span class="o">=</span><span class="n">folderpath</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">main_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sccmsg</span> <span class="o">=</span> <span class="s">"</span><span class="se">\033</span><span class="s">[92mCompiled </span><span class="se">\033</span><span class="s">[94m{d}.tex</span><span class="se">\033</span><span class="s">[92m successfully</span><span class="se">\033</span><span class="s">[0m"</span>\
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">dir_name</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">sccmsg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s">"</span><span class="se">\033</span><span class="s">[91mError with compiling </span><span class="se">\033</span><span class="s">[94m{d}.tex</span><span class="se">\033</span><span class="s">[0m</span><span class="se">\n</span><span class="s">cmd: {c}"</span>\
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cmd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_notify_and_exit</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span></code></pre></figure>


  </div>

  <div class="post-meta post-tags">
    
      <a href="/tags/#gitlab-ci" class="post-tag"> gitlab-ci </a>
    
      <a href="/tags/#latex" class="post-tag"> latex </a>
    
      <a href="/tags/#python" class="post-tag"> python </a>
    
  </div>

  
</article>

      </div>
    </main>
<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="footer-col-wrapper">


  <div style="text-align: center">
    <span><a href="https://www.youtube.com/user/hpitv1"><span class="username"><i class="fa fa-youtube" aria-hidden="true"></i> watch</span></a></span>
    <span><a href="https://www.facebook.com/HassoPlattnerInstitute"><span class="username"><i class="fa fa-facebook-square" aria-hidden="true"></i> stalk</span></a></span>
    <span><a href="https://twitter.com/HPI_DE"><span class="username"><i class="fa fa-twitter" aria-hidden="true"></i> follow</span></a></span>
    <span><a href="https://www.github.com/bachelorprojekte"><i class="fa fa-github-square" aria-hidden="true"></i> judge</span></a></span>
  </div>
</div>
</footer>
<div class="madewith">
  <span class="post-meta">powered by <a href="https://github.com/bachelorprojekte/bachelorprojekte.github.io/tree/jekyll">jekyll</a></span>
</div>
</body>

</html>
